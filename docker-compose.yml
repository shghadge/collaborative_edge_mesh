services:
  gateway:
    build: .
    container_name: gateway
    command: python -m src.gateway_main
    environment:
      - NODE_ID=gateway
      - HTTP_PORT=8000
      - EDGE_NODES=
      - GATEWAY_POLL_INTERVAL=10
      - DATA_DIR=/data
    ports:
      - "7000:8000"
    volumes:
      - gateway-data:/data
    networks:
      mesh:
        ipv4_address: 172.28.0.10

  simulator:
    build: .
    container_name: simulator
    command: python -m src.simulator_main
    environment:
      - NODE_ID=simulator
      - HTTP_PORT=8000
      - LOG_LEVEL=INFO
    ports:
      - "8000:8000"
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
    networks:
      mesh:
        ipv4_address: 172.28.0.9
    depends_on:
      - gateway

volumes:
  gateway-data:

networks:
  mesh:
    driver: bridge
    ipam:
      config:
        - subnet: 172.28.0.0/24
